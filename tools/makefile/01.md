# 一文彻底掌握Makefile

## 介绍

makefile就是一个可以被make命令解析的文件，他定义了一系列编译的规则，帮助我们更加方便、简洁的去完成编译的过程。在一个大工程当中我们会有各种各样的文件，我们可能会分模块去存放各种文件，可能有些文件还依赖其他的文件，因此我们在编译的时候需要先将被依赖的文件先编译，其他文件后编译，而我们使用makefile就可以更好的去完成这件事儿。

## 基本介绍

在很多情况下我们在C/C++的项目当中使用makefile，其实在其他语言的项目也可以使用make和makefile，它不局限于语言的。现在写一个基本的例子：

```makefile
demo: demo.c
	gcc demo.c -o demo

clean:
	rm demo
```

上面是一个makefile的例子，我们简要说明一下makefile的书写规则：

```makefile
编译目标:依赖文件
	编译命令
```

然后我们使用`make`命令去解释执行`makefile`，我们可以使用`make 编译目标`去执行特定的语句，比如在上面的例子当中我们执行`make demo`的话就会执行`gcc demo.c -o demo`命令。

![](../../images/tools/makfile01.png)

其实上面我们也可以直接使用`make`命令，不需要指定编译目标，因为`make`会自己寻找第一个目标作为被执行的目标。

![](../../images/tools/makfile02.png)

在上面的代码当中我们当我们执行`make`的时候寻找到`makefile`文件的第一个目标`demo`，但是因为我没有改动`demo.c`这个文件，而且这个文件已经编译过了，因此我们没有必要再去编译这个文件，因此`make`命令输出`demo`这个目标已经是最新的了。因此我们在执行`make`执行执行`clean`编译目标先删除`demo`这个编译结果，然后在执行`make`这次它再找到`demo`目标，而此时`demo`已经被删除了，因此会重新编译。

